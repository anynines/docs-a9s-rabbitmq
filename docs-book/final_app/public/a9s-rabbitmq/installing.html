<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Installing and Configuring a9s RabbitMQ for PCF |
    
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  <script>
//Global Google Search
(function() {
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + '';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
})();
</script>

<script type="text/javascript">
  if (window.location.host === 'hello') {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_setDomainName', '']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  }
</script>

<script type="text/javascript">
  var blackList = ['acceptance'];

  blackList.forEach(function(blackListedEnv) {
    if (document.URL.indexOf(blackListedEnv) > -1 && blackListedEnv != "") {
      $('head').append('<meta name="hashtag" content="PivotalMoment">');
    }
  });
</script>

<!-- CrazyEgg Tracking Script -->
<script type="text/javascript">
  setTimeout(function() {
    var a = document.createElement("script");
    var b = document.getElementsByTagName("script")[0];
    a.src = document.location.protocol + "//script.crazyegg.com/pages/scripts/0020/8294.js?" + Math.floor(new Date().getTime() / 3600000);
    a.async = true;
    a.type = "text/javascript";
    b.parentNode.insertBefore(a, b)
  }, 1);
</script>

<script type="text/javascript">
  (function() {
    var didInit = false;

    function initMunchkin() {
      if (didInit === false) {
        didInit = true;
        Munchkin.init('625-IUJ-009');
      }
    }

    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
      if (this.readyState == 'complete' || this.readyState == 'loaded') {
        initMunchkin();
      }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
  })();
</script>

</head>

<body class="a9s-rabbitmq a9s-rabbitmq_installing has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "";
    </script>

       
    <header class="header header-layout">
      <h1 class="logo">
        <a href="/">Default Book Title</a>
      </h1>
      
      <div class="header-links js-bar-links">
        <div class="btn-menu" data-behavior="MenuMobile"></div>
        
        <div class="header-item">
          
        </div>
        <!--Default search-->
<!--If book needs something different, add a book-search partial to the book's layouts folder-->
<div class="header-item searchbar js-searchbar">
  <a class="search-icon" data-behavior="Search"></a>
  <div class="search-input">
    <div class="search-input-inner" id="docs-search">
        <gcse:searchbox></gcse:searchbox>
    </div>
  </div>
</div>

      </div>
    </header>



    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    <ul>
      <li>
        <a id='home-nav-link' href="/a9s-rabbitmq/index.html">a9s RabbitMQ for PCF (Beta)</a>
      </li>

      <li>
        <a href="/a9s-rabbitmq/installing.html">Installing and Configuring a9s RabbitMQ for PCF</a>
      </li>

      <li>
        <a href="/a9s-rabbitmq/using.html">Using a9s RabbitMQ for PCF</a>
      </li>

      <li>
        <a href="/a9s-rabbitmq/release-notes.html">Release Notes</a>
      </li>
      
    </ul>
  </div>
</div><!--end of sub-nav-->

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" >
    Installing and Configuring a9s RabbitMQ for PCF
  </h1>

          <div id="js-quick-links" >
            <div class="quick-links"><ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li>
<a href="#install">Install and Configure a9s RabbitMQ for PCF</a><ul>
<li><a href="#azs">Assign AZs and Networks</a></li>
<li><a href="#errands">Configure Errands</a></li>
<li><a href="#configure-service-instance">Configure Service Plans</a></li>
<li><a href="#stemcell">Configure Stemcells</a></li>
</ul>
</li>
<li><a href="#deployment_updater">Upgrade Existing Service Instances After a Tile Update</a></li>
</ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <style>
    .note.warning {
        background-color: #fdd;
        border-color: #fbb
    }
    .note.warning:before {
        color: #f99;
     }
</style>

<p>This topic describes how to install and configure a9s RabbitMQ for Pivotal Cloud Foundry (PCF).</p>

<h2><a id='prerequisites'></a> Prerequisites</h2>

<p>Before installing a9s RabbitMQ for PCF, ensure that you have installed and configured the products and tiles listed in <a href="/a9s-rabbitmq/#reqs">Requirements</a>.</p>

<h2><a id='install'></a> Install and Configure a9s RabbitMQ for PCF</h2>

<p>To install a9s RabbitMQ for PCF, perform the following steps:</p>

<ol>
<li><p>Download the product file from <a href="https://network.pivotal.io/">Pivotal Network</a>.</p></li>
<li><p>Navigate to the Ops Manager Installation Dashboard and click <strong>Import a Product</strong> to upload the product file.</p></li>
<li><p>Under the <strong>Import a Product</strong> button, click <strong>+</strong> next to the version number of a9s RabbitMQ for PCF.
This adds the tile to your staging area.</p></li>
<li><p>Click the newly added tile, and then click <strong>Settings</strong> to review the configuration settings.
See the following sections for more information on how to configure the properties on each settings pane:</p>

<ul>
<li><a href="#azs">Assign AZs and Networks</a></li>
<li><a href="#errands">Configure BOSH Errands</a></li>
<li><a href="#configure-service-instance">Configure Service Plans</a></li>
<li><a href="#stemcell">Configure Stemcells</a></li>
</ul></li>
<li><p>Click <strong>Apply Changes</strong> to deploy the service.</p></li>
</ol>

<p>After you install a9s RabbitMQ for PCF, developers can access the service in the marketplace. See <a href="/a9s-rabbitmq/using.html">Using a9s RabbitMQ for PCF</a>.</p>

<h3><a id="azs"></a>Assign AZs and Networks</h3>

<p>Use <strong>Assign AZs and Networks</strong> to configure the location of service instance jobs. Configure your network to balance cluster jobs across as many AZs as possible.</p>

<p><img src="images/az-and-networks.png" /></p>

<h3><a id='errands'></a>Configure Errands</h3>

<p>Use <strong>Errands</strong> to configure the BOSH errands used by a9s RabbitMQ for PCF. The list below describes each errand. For more information, see <a href="https://docs.pivotal.io/tiledev/tile-errands.html">Understanding Lifecycle Errands</a>.</p>

<p><img src="images/a9s-rabbitmq-for-pcf-errands.png" /></p>

<h4>Post-Deployment Errands</h4>

<ul>
<li><p><strong>Run BOSH Configurator</strong>:
This errand configures a9s BOSH for PCF so that it can provision RabbitMQ
service instances. When enabled, this errand uploads the required
stemcells in the BOSH release. Disabling this errand may speed up the
deployment of all tiles.</p>

<p class="note"><strong>Note</strong>: To ensure your configuration remains up-to-date, disable this errand only when necessary.</p></li>
<li><p><strong>Run Template Uploader</strong>:
This errand is required to configure generic components that are included in a9s RabbitMQ for PCF with RabbitMQ  configurations.
Disabling this errand may speed up the deployment of all tiles.</p>

<p class="note"><strong>Note</strong>: To ensure your configuration remains up-to-date, disable this errand only when necessary.</p></li>
<li><p><strong>Run Broker Registrar</strong>:
This errand registers the a9s RabbitMQ for PCF service broker
at the Elastic Runtime. This makes the service available in the Elastic Runtime
marketplace.</p></li>
<li><p><strong>Run Smoke Tests</strong>:
This errand runs a series of basic tests against your a9s RabbitMQ for PCF
installation to ensure that it is configured properly. The tests can
take over 30 minutes.</p></li>
</ul>

<h4>Pre-Delete Errands</h4>

<ul>
<li><p><strong>Delete all a9s RabbitMQ instances</strong>:
This errand deletes all a9s RabbitMQ instances that were created with the <code>cf create-service</code> command by PCF end users.
<p class="note warning"><strong>Warning</strong>: This task cannot be undone. All VMs of the service instances are permanently deleted. If a service instance is bound to an app or service keys are existing, the errand fails.</p></p></li>
<li><p><strong>Run Broker Deregistrar</strong>:
This errand unregisters the a9s RabbitMQ for PCF service broker in Elastic Runtime. It also removes the a9s RabbitMQ service from the Elastic Runtime marketplace.</p></li>
</ul>

<h3><a id="configure-service-instance"></a> Configure Service Plans</h3>

<p>The sizes and types of VMs used to provision service instances of a given service plan are specified in <strong>IaaS Settings</strong> of the <strong>a9s BOSH for PCF</strong> tile.</p>

<p class="note"><strong>Note</strong>: For information on cloud properties, see the <em>Cloud Config</em> section of the <a href="http://docs.pivotal.io/partners/a9s-bosh/installing.html">a9s BOSH for PCF installation documentation</a> that corresponds to your IaaS.</p>

<p>See the table below for a summary of available service plans:</p>

<table><thead>
<tr>
<th>This plan&hellip;</th>
<th>Uses these a9s BOSH for PCF settings to determine VM and Disk size</th>
</tr>
</thead><tbody>
<tr>
<td>rabbitmq-single-small</td>
<td>Cloud properties for the VM Type Small<br /> Cloud properties for the Disk Type Small</td>
</tr>
<tr>
<td>rabbitmq-cluster-small</td>
<td>Cloud properties for the VM Type Small<br /> Cloud properties for the Disk Type Small</td>
</tr>
<tr>
<td>rabbitmq-single-big</td>
<td>Cloud properties for the VM Type Large<br /> Cloud properties for the Disk Type Big</td>
</tr>
<tr>
<td>rabbitmq-cluster-big</td>
<td>Cloud properties for the VM Type Large<br /> Cloud properties for the Disk Type Big</td>
</tr>
</tbody></table>

<h3><a id="stemcell"></a>Configure Stemcells</h3>

<p>If you want to use a stemcell other than the default, click <strong>Stemcell</strong>, and then click <strong>Import Stemcell</strong> to upload the stemcell.</p>

<p><img src="images/stemcell-tab.png" /></p>

<h2><a id='deployment_updater'></a>Upgrade Existing Service Instances After a Tile Update</h2>

<p>After updating the a9s RabbitMQ for PCF tile, run this errand to update the stemcell and all provisioned service instances to their latest version.</p>

<p class="note"><strong>Note</strong>: anynines recommends running the <a href="./installing.html#errands" target="_blank">smoke tests</a> before running this errand.</p>

<p class="note"><strong>Note</strong>: To run the errand, you must know how to use the Ops Manager Director. For more information, see the
<a href="http://docs.pivotal.io/pivotalcf/1-9/customizing/trouble-advanced.html#prepare" target="_blank">Advanced Troubleshooting with the BOSH CLI</a> topic.</p>

<ol>
<li>SSH into Ops Manager:
<pre class="terminal">
$ ssh ubuntu@OPS-MANAGER-FQDN
Password: ***********
</pre></li>
<li>Target the Ops Manager Director:
<pre class="terminal">
$ bosh --ca-cert /var/tempest/workspaces/default/root_ca_certificate target OPS-MANAGER-DIRECTOR-IP
Target set to DIRECTOR_UUID
</pre></li>
<li>Log in to the Ops Manager Director:
<pre class="terminal">
$ bosh login
Your username: director
Enter password: DIRECTOR_CREDENTIAL
Logged in as &#39;director&#39;
</pre></li>
<li>Locate the a9s RabbitMQ for PCF deployment name:
<pre class="terminal">
$ bosh deployments
</pre>
The output should look similar to the following:
<pre class="terminal">
Acting as user &#39;director&#39; on &#39;p-bosh&#39;
+-------------------------------------------+-------------------------------+-------------
| Name                                      | Release(s)                    | Stemcell(s)
+-------------------------------------------+-------------------------------+-------------
| a9s-bosh-a40c3b10d101faca4fbc             | bosh-aws-cpi/53               | bosh-vsphere
| ...
+-------------------------------------------+-------------------------------+-------------
| a9s-consul-dns-3f3a49fb941f8c0874cb       | consul/9                      | bosh-vsphere
| ...
+-------------------------------------------+-------------------------------+-------------
| a9s-rabbitmq-service-94443f82b52dcf333bbd | bosh-configurator-rabbitmq/3  | bosh-vsphere
| ...
+-------------------------------------------+-------------------------------+-------------
</pre></li>
<li>All deployment manifests are stored in the <code>/var/tempest/workspaces/default/deployments/</code> folder. Choose the <code>a9s-rabbitmq-service-...</code> deployment.
<pre class="terminal">
$ bosh deployment /var/tempest/workspaces/default/deployments/a9s-rabbitmq-service-94443f82b52dcf333bbd.yml
% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                           Dload  Upload   Total   Spent    Left  Speed
100   352  100   352    0     0  12014      0 --:--:-- --:--:-- --:--:-- 12137
Deployment set to &#39;/var/tempest/workspaces/default/deployments/a9s-rabbitmq-service-94443f82b52dcf333bbd.yml&#39;</pre></li>
<li>Run <code>bosh run errand deployment-updater</code> to force a service instances update for all existing a9s RabbitMQ for PCF instances.
<pre class="terminal">
$ bosh run errand deployment-updater
% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                           Dload  Upload   Total   Spent    Left  Speed
100   352  100   352    0     0  26378      0 --:--:-- --:--:-- --:--:-- 27076
Acting as user &#39;director&#39; on deployment &#39;a9s-rabbitmq-service-94443f82b52dcf333bbd&#39; on &#39;p-bosh&#39;
&nbsp;
Director task 6533
Started preparing deployment &gt; Preparing deployment. Done (00:00:01)
&nbsp;
...
&nbsp;
Errand &#39;deployment-updater&#39; completed successfully (exit code 0)
</pre>
<p class="note"><strong>Note</strong>: Depending on the number of service instances, the Deployment Updater may take a significant amount of time to finish running. While the errand runs, BOSH shows no logging output from the errand.</p></li>
</ol>

          <gcse:searchresults></gcse:searchresults>
<a id='repo-link' href='http://github.com/docs-content/tree/master/installing.html.md.erb'>View the source for this page in GitHub</a>

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
  <a href='http://pivotal.io/privacy-policy'>Privacy Policy</a> | 
  <a href='http://pivotal.io/terms-of-use'>Terms of Use</a><br/>
  <a href='/'>Pivotal Documentation</a>
  &copy; 2017 <a href='http://pivotal.io'>Pivotal Software</a>, Inc. All Rights Reserved.
</div>
<div class="support">
  Need help? <a href="" target="_blank">Visit Support</a>
</div>

  </footer>
</div><!--end of container-->

</body>
</html>
