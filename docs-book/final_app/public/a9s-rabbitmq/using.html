<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Using a9s RabbitMQ for PCF |
    
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  <script>
//Global Google Search
(function() {
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + '';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
})();
</script>

<script type="text/javascript">
  if (window.location.host === 'hello') {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_setDomainName', '']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  }
</script>

<script type="text/javascript">
  var blackList = ['acceptance'];

  blackList.forEach(function(blackListedEnv) {
    if (document.URL.indexOf(blackListedEnv) > -1 && blackListedEnv != "") {
      $('head').append('<meta name="hashtag" content="PivotalMoment">');
    }
  });
</script>

<!-- CrazyEgg Tracking Script -->
<script type="text/javascript">
  setTimeout(function() {
    var a = document.createElement("script");
    var b = document.getElementsByTagName("script")[0];
    a.src = document.location.protocol + "//script.crazyegg.com/pages/scripts/0020/8294.js?" + Math.floor(new Date().getTime() / 3600000);
    a.async = true;
    a.type = "text/javascript";
    b.parentNode.insertBefore(a, b)
  }, 1);
</script>

<script type="text/javascript">
  (function() {
    var didInit = false;

    function initMunchkin() {
      if (didInit === false) {
        didInit = true;
        Munchkin.init('625-IUJ-009');
      }
    }

    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
      if (this.readyState == 'complete' || this.readyState == 'loaded') {
        initMunchkin();
      }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
  })();
</script>

</head>

<body class="a9s-rabbitmq a9s-rabbitmq_using has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "";
    </script>

       
    <header class="header header-layout">
      <h1 class="logo">
        <a href="/">Default Book Title</a>
      </h1>
      
      <div class="header-links js-bar-links">
        <div class="btn-menu" data-behavior="MenuMobile"></div>
        
        <div class="header-item">
          
        </div>
        <!--Default search-->
<!--If book needs something different, add a book-search partial to the book's layouts folder-->
<div class="header-item searchbar js-searchbar">
  <a class="search-icon" data-behavior="Search"></a>
  <div class="search-input">
    <div class="search-input-inner" id="docs-search">
        <gcse:searchbox></gcse:searchbox>
    </div>
  </div>
</div>

      </div>
    </header>



    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    <ul>
      <li>
        <a id='home-nav-link' href="/a9s-rabbitmq/index.html">a9s RabbitMQ for PCF (Beta)</a>
      </li>

      <li>
        <a href="/a9s-rabbitmq/installing.html">Installing and Configuring a9s RabbitMQ for PCF</a>
      </li>

      <li>
        <a href="/a9s-rabbitmq/using.html">Using a9s RabbitMQ for PCF</a>
      </li>

      <li>
        <a href="/a9s-rabbitmq/release-notes.html">Release Notes</a>
      </li>
      
    </ul>
  </div>
</div><!--end of sub-nav-->

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" >
    Using a9s RabbitMQ for PCF
  </h1>

          <div id="js-quick-links" >
            <div class="quick-links"><ul>
<li><a href="#using">Use a9s RabbitMQ for PCF with an App</a></li>
<li><a href="#credentials">Obtain Service Instance Access Credentials</a></li>
<li><a href="#deleting">Delete a Service Instance</a></li>
<li><a href="#upgrade-service-plan">Change Service Plan</a></li>
<li><a href="#add-graphite-endpoint">Add a Graphite Endpoint</a></li>
<li><a href="#add-syslog-endpoint">Add a Syslog Endpoint</a></li>
</ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <style>
    .note.warning {
        background-color: #fdd;
        border-color: #fbb
    }
    .note.warning:before {
        color: #f99;
     }
</style>

<p>This topic describes how to use a9s RabbitMQ for Pivotal Cloud Foundry (PCF) after it has been successfully <a href="/a9s-rabbitmq/installing.html">installed</a>.</p>

<h2><a id='using'></a>Use a9s RabbitMQ for PCF with an App</h2>

<p>To use a9s RabbitMQ for PCF with an app, create a service instance and bind it
to your app by following the steps below. For more information on managing service instances, see <a href="http://docs.pivotal.io/pivotalcf/devguide/services/managing-services.html" target="_blank">Managing Service Instances with the cf CLI</a>.</p>

<h3>View the Service</h3>

<p>After the tile is installed, run <code>cf marketplace</code> to see <code>a9s-rabbitmq</code> and its service plans:
<pre class="terminal">
$ cf marketplace
Getting services from marketplace in org test / space test as admin...
OK
service         plans                                             description
a9s-rabbitmq36  rabbitmq-single-small, rabbitmq-cluster-small,    This is the anynines rabbitmq 36 service.
                rabbitmq-single-big, rabbitmq-cluster-big
</pre></p>

<p>For more information on available service plans, see <a href="/a9s-rabbitmq/installing.html#configure-service-instance">Configure Service Plans</a>.</p>

<h3>Create a Service Instance</h3>

<p>To provision a RabbitMQ database, run <code>cf create-service</code>. For example:</p>

<pre class="terminal">
$ cf create-service a9s-rabbitmq36 rabbitmq-single-small my-rabbitmq-service
</pre>

<p class="note"><strong>Note</strong>: This may take several minutes.</p>

<p>Run the <code>cf services</code> command to list all your service instances. To view the status of a specific service instance, run <code>cf service NAME-OF-YOUR-SERVICE</code>.</p>

<h3>Bind an App to a Service Instance</h3>

<p>After you create your databaes, run <code>cf bind-service</code> to bind the service to your app:</p>

<pre class="terminal">
$ cf bind-service MY-APP-NAME MY-RABBITMQ-SERVICE
</pre>

<h3>Restage or Restart Your App</h3>

<p>To enable your app to access the service instance, run <code>cf restage MY-APP-NAME</code> or <code>cf restart MY-APP-NAME</code>.</p>

<h2><a id='credentials'></a> Obtain Service Instance Access Credentials</h2>

<p>After you bind a service instance to an app, PCF stores the credentials of your RabbitMQ database in the environment variables of the app. Run <code>cf env APP-NAME</code> to display the environment variables.</p>

<p>You can find the credentials in the <a href="http://docs.pivotal.io/pivotalcf/devguide/deploy-apps/environment-variable.html#VCAP-SERVICES" target="_blank">VCAP_SERVICES</a> key.</p>

<pre class="terminal">
$ cf env MY-APP
Getting env variables for app MY-APP in org test / space test as admin...
OK

System-Provided:
{
 "VCAP_SERVICES": {
  "a9s-rabbitmq": [
   {
    "credentials": {
     "default_database": "d22906",
     "hosts": [
      "EXAMPLE-HOST"
     ],
     "password": "EXAMPLE-PASSWORD",
     "uri": "EXAMPLE-URI",
     "username": "EXAMPLE-USERNAME"
    },
    "label": "a9s-rabbitmq",
    "name": "my-rabbitmq-service",
    "plan": "rabbitmq-single-small",
    "tags": [
     "nosql",
     "database",
     "document store",
     "eventual consistent"
    ]
   }
  ]
 }
}
...
</pre>

<p>You can use the host, username, and password to connect to your database with a RabbitMQ client.</p>

<h2><a id='deleting'></a> Delete a Service Instance</h2>

<p class="note warning"><strong>Warning</strong>: This operation cannot be undone and the data is lost when the service is deleted. If you want to keep your data, you must back up your database before deleting the service instance.</p>

<p>Follow the steps below to unbind the service instance from all apps and then delete it. </p>

<h3>List Available Services</h3>

<p>Run <code>cf service</code> to list your available services and get the name of the service instance you want to delete.</p>

<pre class="terminal">
$ cf service

Getting services in org test / space test as admin...
OK

name                  service          plan                    bound apps         last operation
my-rabbitmq-service   a9s-rabbitmq36   rabbitmq-single-small   a9s-rabbitmq-app   create succeeded
</pre>

<p>This example shows that <code>my-rabbitmq-service</code> is bound to the <code>a9s-rabbitmq-app</code> app.</p>

<h3>Unbind a Service Instance</h3>

<p>Run <code>cf unbind-service</code> to unbind the service from your app.</p>

<pre class="terminal">
$ cf unbind-service a9s-rabbitmq-app my-rabbitmq-service
</pre>

<h3>Delete a Service Instance</h3>

<p>Run <code>cf delete-service</code> to delete the service:</p>

<pre class="terminal">
$ cf delete-service my-rabbitmq-service
</pre>

<p class="note"><strong>Note</strong>: This may take several minutes.</p>

<p>Deleting a service deprovisions the corresponding infrastructure resources. Run the <code>cf services</code> command to view the deletion status.</p>

<h2><a id='upgrade-service-plan'></a> Change Service Plan</h2>

<p>You can modify your service instance to use a different service plan. You may want to use a larger service plan that provides more CPU, RAM, and storage. For more information, see <a href="http://docs.pivotal.io/pivotalcf/devguide/services/managing-services.html#update_service" target="_blank">Update a Service Instance</a>. For example:</p>

<pre class="terminal">
$ cf update-service my-rabbitmq-service -p a-bigger-plan
</pre>

<p>You may choose to upgrade your service plan in one of the following ways:</p>

<ul>
<li><p>From <code>rabbitmq-single-small</code> to <code>rabbitmq-single-big</code></p></li>
<li><p>From <code>rabbitmq-cluster-small</code> to <code>rabbitmq-cluster-big</code></p></li>
</ul>

<h2><a id='add-graphite-endpoint'></a>Add a Graphite Endpoint</h2>

<p>If you want to monitor your RabbitMQ service with <a href="https://graphiteapp.org/">Graphite</a>, you can specify an endpoint to send data to with the <code>cf update-service</code> command. This command expects the <a href="http://docs.pivotal.io/pivotalcf/devguide/services/managing-services.html#arbitrary-params-update" target="_blank">-c flag</a>
and a JSON string containing the <code>graphite</code> and <code>metrics_prefix</code> keys. For example: </p>

<pre class="terminal">
$ cf update-service my-rabbitmq-service -c '{ "graphite": ["yourspace.your-graphite-endpoint.com:12345"], "metrics_prefix": "your-api-key.my-cluster-rabbitmq" }'
</pre>

<h2><a id='add-syslog-endpoint'></a>Add a Syslog Endpoint</h2>

<p>You can stream your syslog to a third-party service using the <code>cf update-service</code> command and the <a href="http://docs.pivotal.io/pivotalcf/devguide/services/managing-services.html#arbitrary-params-update" target="_blank">-c flag</a>. In this case, the command expects a JSON string containing the <code>syslog</code> key. For example:</p>

<pre class="terminal">
$ cf update-service my-rabbitmq-service -c '{ "syslog": ["logs4.your-syslog-endpoint.com:54321"] }'
</pre>

          <gcse:searchresults></gcse:searchresults>
<a id='repo-link' href='http://github.com/docs-content/tree/master/using.html.md.erb'>View the source for this page in GitHub</a>

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
  <a href='http://pivotal.io/privacy-policy'>Privacy Policy</a> | 
  <a href='http://pivotal.io/terms-of-use'>Terms of Use</a><br/>
  <a href='/'>Pivotal Documentation</a>
  &copy; 2017 <a href='http://pivotal.io'>Pivotal Software</a>, Inc. All Rights Reserved.
</div>
<div class="support">
  Need help? <a href="" target="_blank">Visit Support</a>
</div>

  </footer>
</div><!--end of container-->

</body>
</html>
